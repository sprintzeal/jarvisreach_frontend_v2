{"version":3,"file":"index.js","sources":["../src/useLinkedIn.tsx","../src/utils.ts","../src/LinkedIn.tsx","../src/LinkedInCallback.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef } from 'react';\nimport { useLinkedInType } from './types';\nimport { LINKEDIN_OAUTH2_STATE } from './utils';\n\nconst getPopupPositionProperties = ({ width = 600, height = 600 }) => {\n  const left = screen.width / 2 - width / 2;\n  const top = screen.height / 2 - height / 2;\n  return `left=${left},top=${top},width=${width},height=${height}`;\n};\n\nconst generateRandomString = (length = 20) => {\n  let result = '';\n  const characters =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n};\n\nexport function useLinkedIn({\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  scope = 'r_emailaddress',\n  state = '',\n  closePopupMessage = 'User closed the popup',\n}: useLinkedInType) {\n  const popupRef = useRef<Window>(null);\n  const popUpIntervalRef = useRef<number>(null);\n\n  const receiveMessage = useCallback(\n    (event: MessageEvent) => {\n      const savedState = localStorage.getItem(LINKEDIN_OAUTH2_STATE);\n      if (event.origin === window.location.origin) {\n        if (event.data.errorMessage && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            popupRef.current && popupRef.current.close();\n            return;\n          }\n          onError && onError(event.data);\n          popupRef.current && popupRef.current.close();\n        } else if (event.data.code && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            console.error('State does not match');\n            popupRef.current && popupRef.current.close();\n            return;\n          }\n          onSuccess && onSuccess(event.data.code);\n          popupRef.current && popupRef.current.close();\n        }\n      }\n    },\n    [onError, onSuccess],\n  );\n\n  useEffect(() => {\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n\n      if (popupRef.current) {\n        popupRef.current.close();\n        popupRef.current = null;\n      }\n      if (popUpIntervalRef.current) {\n        window.clearInterval(popUpIntervalRef.current);\n        popUpIntervalRef.current = null;\n      }\n    };\n  }, [receiveMessage]);\n\n  useEffect(() => {\n    window.addEventListener('message', receiveMessage, false);\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n    };\n  }, [receiveMessage]);\n\n  const getUrl = () => {\n    const scopeParam = `&scope=${encodeURI(scope)}`;\n    const generatedState = state || generateRandomString();\n    localStorage.setItem(LINKEDIN_OAUTH2_STATE, generatedState);\n    const linkedInAuthLink = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${clientId}&redirect_uri=${redirectUri}${scopeParam}&state=${generatedState}`;\n    return linkedInAuthLink;\n  };\n\n  const linkedInLogin = () => {\n    popupRef.current?.close();\n    popupRef.current = window.open(\n      getUrl(),\n      '_blank',\n      getPopupPositionProperties({ width: 600, height: 600 }),\n    );\n\n    if (popUpIntervalRef.current) {\n      window.clearInterval(popUpIntervalRef.current);\n      popUpIntervalRef.current = null;\n    }\n    popUpIntervalRef.current = window.setInterval(() => {\n      try {\n        if (popupRef.current && popupRef.current.closed) {\n          window.clearInterval(popUpIntervalRef.current);\n          popUpIntervalRef.current = null;\n          if (onError) {\n            onError({\n              error: 'user_closed_popup',\n              errorMessage: closePopupMessage,\n            });\n          }\n        }\n      } catch (error) {\n        console.error(error);\n        window.clearInterval(popUpIntervalRef.current);\n        popUpIntervalRef.current = null;\n      }\n    }, 1000);\n  };\n\n  return {\n    linkedInLogin,\n  };\n}\n","export const LINKEDIN_OAUTH2_STATE = 'linkedin_oauth2_state';\n\nexport function parse(search) {\n  const query = search.substring(1);\n  const vars = query.split('&');\n  const parsed = {};\n  for (let i = 0; i < vars.length; i++) {\n    const pair = vars[i].split('=');\n    if (pair.length > 1) {\n      parsed[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n  }\n  return parsed;\n}\n","import { LinkedInType } from './types';\nimport { useLinkedIn } from './useLinkedIn';\n\nexport function LinkedIn({\n  children,\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  state,\n  scope,\n  closePopupMessage,\n}: LinkedInType) {\n  const { linkedInLogin } = useLinkedIn({\n    redirectUri,\n    clientId,\n    onSuccess,\n    onError,\n    state,\n    scope,\n    closePopupMessage,\n  });\n  return children({ linkedInLogin });\n}\n","import { useEffect, useState } from 'react';\nimport { LINKEDIN_OAUTH2_STATE, parse } from './utils';\n\ntype ParamsType = {\n  state: string;\n  code?: string;\n  error?: string;\n  error_description?: string;\n};\n\nexport function LinkedInCallback() {\n  const [errorMessage, setErrorMessage] = useState<string>('');\n  useEffect(() => {\n    const params = parse(window.location.search) as ParamsType;\n    if (params.state !== localStorage.getItem(LINKEDIN_OAUTH2_STATE)) {\n      setErrorMessage('State does not match');\n    } else if (params.error) {\n      const errorMessage =\n        params.error_description || 'Login failed. Please try again.';\n      window.opener &&\n        window.opener.postMessage(\n          {\n            error: params.error,\n            state: params.state,\n            errorMessage,\n            from: 'Linked In',\n          },\n          window.location.origin,\n        );\n      // Close tab if user cancelled login\n      if (params.error === 'user_cancelled_login') {\n        window.close();\n      }\n    }\n    if (params.code) {\n      window.opener &&\n        window.opener.postMessage(\n          { code: params.code, state: params.state, from: 'Linked In' },\n          window.location.origin,\n        );\n    }\n  }, []);\n\n  return <div>{errorMessage}</div>;\n}\n"],"names":["useLinkedIn","_a","redirectUri","clientId","onSuccess","onError","_b","scope","_c","state","_d","closePopupMessage","popupRef","useRef","popUpIntervalRef","receiveMessage","useCallback","event","savedState","localStorage","getItem","origin","window","location","data","errorMessage","from","current","close","code","useEffect","removeEventListener","clearInterval","addEventListener","getUrl","scopeParam","encodeURI","generatedState","length","result","characters","charactersLength","i","charAt","Math","floor","random","generateRandomString","setItem","linkedInLogin","open","width","height","screen","getPopupPositionProperties","setInterval","closed","error","children","useState","setErrorMessage","params","search","vars","substring","split","parsed","pair","decodeURIComponent","parse","errorMessage_1","error_description","opener","postMessage","_jsx"],"mappings":"mIAqBgBA,EAAYC,OAC1BC,gBACAC,aACAC,cACAC,YACAC,UAAAC,aAAQ,mBACRC,UAAAC,aAAQ,KACRC,sBAAAC,aAAoB,0BAEdC,EAAWC,SAAe,MAC1BC,EAAmBD,SAAe,MAElCE,EAAiBC,eACrB,SAACC,GACC,IAAMC,EAAaC,aAAaC,QCnCD,yBDoC/B,GAAIH,EAAMI,SAAWC,OAAOC,SAASF,OACnC,GAAIJ,EAAMO,KAAKC,cAAoC,cAApBR,EAAMO,KAAKE,KAAsB,CAE9D,GAAIT,EAAMO,KAAKf,QAAUS,EAEvB,YADAN,EAASe,SAAWf,EAASe,QAAQC,SAGvCvB,GAAWA,EAAQY,EAAMO,MACzBZ,EAASe,SAAWf,EAASe,QAAQC,aAChC,GAAIX,EAAMO,KAAKK,MAA4B,cAApBZ,EAAMO,KAAKE,KAAsB,CAE7D,GAAIT,EAAMO,KAAKf,QAAUS,EAGvB,YADAN,EAASe,SAAWf,EAASe,QAAQC,SAGvCxB,GAAaA,EAAUa,EAAMO,KAAKK,MAClCjB,EAASe,SAAWf,EAASe,QAAQC,WAI3C,CAACvB,EAASD,IAGZ0B,aAAU,WACR,OAAO,WACLR,OAAOS,oBAAoB,UAAWhB,GAAgB,GAElDH,EAASe,UACXf,EAASe,QAAQC,QACjBhB,EAASe,QAAU,MAEjBb,EAAiBa,UACnBL,OAAOU,cAAclB,EAAiBa,SACtCb,EAAiBa,QAAU,SAG9B,CAACZ,IAEJe,aAAU,WAER,OADAR,OAAOW,iBAAiB,UAAWlB,GAAgB,GAC5C,WACLO,OAAOS,oBAAoB,UAAWhB,GAAgB,MAEvD,CAACA,IAEJ,IAAMmB,EAAS,WACb,IAAMC,EAAa,UAAUC,UAAU7B,GACjC8B,EAAiB5B,GA1EE,SAAC6B,gBAAAA,MAK5B,IAJA,IAAIC,EAAS,GACPC,EACJ,iEACIC,EAAmBD,EAAWF,OAC3BI,EAAI,EAAGA,EAAIJ,EAAQI,IAC1BH,GAAUC,EAAWG,OAAOC,KAAKC,MAAMD,KAAKE,SAAWL,IAEzD,OAAOF,EAkE2BQ,GAGhC,OAFA5B,aAAa6B,QCrFoB,wBDqFWX,GACnB,gFAAgFlC,mBAAyBD,EAAciC,YAAoBE,GAoCtK,MAAO,CACLY,cAjCoB,2BACpBrC,EAASe,wBAASC,QAClBhB,EAASe,QAAUL,OAAO4B,KACxBhB,IACA,SA1F6B,SAACjC,OAAEK,UAAA6C,aAAQ,MAAK3C,WAAA4C,aAAS,MAG1D,MAAO,SAFMC,OAAOF,MAAQ,EAAIA,EAAQ,YAC5BE,OAAOD,OAAS,EAAIA,EAAS,aACDD,aAAgBC,EAwFpDE,CAA2B,CAAEH,MAAO,IAAKC,OAAQ,OAG/CtC,EAAiBa,UACnBL,OAAOU,cAAclB,EAAiBa,SACtCb,EAAiBa,QAAU,MAE7Bb,EAAiBa,QAAUL,OAAOiC,aAAY,WAC5C,IACM3C,EAASe,SAAWf,EAASe,QAAQ6B,SACvClC,OAAOU,cAAclB,EAAiBa,SACtCb,EAAiBa,QAAU,KACvBtB,GACFA,EAAQ,CACNoD,MAAO,oBACPhC,aAAcd,KAIpB,MAAO8C,GAEPnC,OAAOU,cAAclB,EAAiBa,SACtCb,EAAiBa,QAAU,QAE5B,iCEpHkB1B,GAmBvB,OAAOyD,cAAS,CAAET,cATQjD,EAAY,CACpCE,0BACAC,oBACAC,sBACAC,kBACAI,cACAF,cACAI,6FCTI,IAAAV,EAAkC0D,WAAiB,IAAlDlC,OAAcmC,OAgCrB,OA/BA9B,aAAU,WACR,IAAM+B,WFXYC,GAIpB,IAHA,IACMC,EADQD,EAAOE,UAAU,GACZC,MAAM,KACnBC,EAAS,GACNxB,EAAI,EAAGA,EAAIqB,EAAKzB,OAAQI,IAAK,CACpC,IAAMyB,EAAOJ,EAAKrB,GAAGuB,MAAM,KACvBE,EAAK7B,OAAS,IAChB4B,EAAOE,mBAAmBD,EAAK,KAAOC,mBAAmBD,EAAK,KAGlE,OAAOD,EECUG,CAAM/C,OAAOC,SAASuC,QACrC,GAAID,EAAOpD,QAAUU,aAAaC,QFdD,yBEe/BwC,EAAgB,6BACX,GAAIC,EAAOJ,MAAO,CACvB,IAAMa,EACJT,EAAOU,mBAAqB,kCAC9BjD,OAAOkD,QACLlD,OAAOkD,OAAOC,YACZ,CACEhB,MAAOI,EAAOJ,MACdhD,MAAOoD,EAAOpD,MACdgB,eACAC,KAAM,aAERJ,OAAOC,SAASF,QAGC,yBAAjBwC,EAAOJ,OACTnC,OAAOM,QAGPiC,EAAOhC,MACTP,OAAOkD,QACLlD,OAAOkD,OAAOC,YACZ,CAAE5C,KAAMgC,EAAOhC,KAAMpB,MAAOoD,EAAOpD,MAAOiB,KAAM,aAChDJ,OAAOC,SAASF,UAGrB,IAEIqD,sBAAMjD"}